<!DOCTYPE html>
<html lang="ru"
      xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <div th:replace="~{fragments/head :: head}"></div>

    <title>Список товаров</title>
</head>
<body>
<!-- Это будут фрагменты thymeleaf -->
<header>
    <nav th:replace="~{fragments/navbar :: navbar('managing')}"></nav>
</header>
<main class="container d-flex flex-column px-0 py-8 main-container-size">
    <!--        Объявление форм -->
    <form id="enable-delete-bulk-form" th:action="@{${thisEndpoint}}"></form>
    <form id="delete-bulk-form" th:action="@{${deleteEndpoint}}" method="post" onsubmit="onSubmit()"></form>

    <div class="row justify-content-center m-0">
        <div class="col-auto ms-md-4 mb-7 p-0">
            <h1 class="m-0">Список сотрудников</h1>
        </div>
    </div>
    <!--        Элементы управления таблицей    -->
    <div
        sec:authorize="hasAuthority('USER_DELETE')"
        th:if="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}"
        class="row justify-content-end mx-0 mb-4"
    >
        <div class="col-md-auto p-0 d-flex justify-content-center">
            <button
                    class="btn btn-info rounded-custom p-button"
                    form="enable-delete-bulk-form"
                    type="submit"
            >
                Отмена
            </button>
        </div>
        <div class="col-md-auto p-0 mt-4 mt-md-0 d-flex justify-content-center">
            <button
                    class="btn btn-danger ms-md-3 rounded-custom p-button"
                    form="delete-bulk-form"
                    type="submit"
            >
               Удалить учетные записи
            </button>
        </div>
    </div>
    <div
            th:unless="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}"
            class="row justify-content-end mx-0 mb-4"
    >
        <div sec:authorize="hasAuthority('USER_CREATE')" class="col-md-auto p-0 d-flex justify-content-center">
            <a
                    class="btn btn-primary rounded-custom p-button"
                    th:href="@{${thisEndpoint} + '/new'}"
            >
                Зарегистрировать пользователя
            </a>
        </div>
        <div sec:authorize="hasAuthority('USER_DELETE')" class="col-md-auto p-0 mt-4 mt-md-0 d-flex justify-content-center">
            <button
                    class="btn btn-danger ms-md-3 rounded-custom p-button"
                    form="enable-delete-bulk-form"
                    type="submit"
                    name="delete_employees" value="true"
            >
                Удалить учетные записи
            </button>
        </div>
    </div>

    <div class="row table-responsive bg-light rounded-4 mx-0 mb-4 p-4">
        <table class="table table-hover">
            <thead>
            <tr>
                <th scope="col">
                    <input th:if="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}"
                           class="form-check-input"
                           form="delete-bulk-form"
                           type="checkbox" id="switch-all"
                           onclick="selectAllCheckBoxes()"
                    />
                    <span th:unless="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}">#</span>
                </th>
                <th scope="col">Адрес электронной почты (email)</th>

                <th scope="col">Номер телефона (phone number)</th>

                <th scope="col">Фамилия (lastname)</th>
                <th scope="col">Имя (firstname)</th>
                <th scope="col">Отчество (patronym)</th>

                <th scope="col">День рождения (birthday)</th>

                <th scope="col">Роль (role)</th>

                <div sec:authorize="hasAuthority('USER_EDIT')">
                    <th scope="col">Редактировать учетные данные (edit)</th>
                </div>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${users}">
                <td class="align-middle">
                    <input
                            th:if="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}"
                            class="form-check-input"
                            form="delete-bulk-form"
                            type="checkbox"
                            name="id" th:value="${user.id}"
                    >
                    <span
                            th:unless="${(param.delete_employees != null) and (param.delete_employees[0] == 'true')}"
                            th:text="${userStat.count}"
                    ></span>
                </td>
                <td class="align-middle" th:text="${user.email}"></td>

                <td class="align-middle" th:text="${user.phoneNumber}"></td>

                <td class="align-middle" th:text="${user.lastname}"></td>
                <td class="align-middle" th:text="${user.firstname}"></td>
                <td class="align-middle" th:text="${user.patronym}"></td>

                <td class="align-middle" th:text="${user.birthday}"></td>

                <td class="align-middle" th:text="${user.role.humanReadableName}"></td>

                <div sec:authorize="hasAuthority('USER_CREATE')">
                    <td>
                        <a class="update-table-entry" th:href="@{${thisEndpoint} + '/' + ${user.id}}">
                            <svg xmlns="http://www.w3.org/2000/svg">
                                <use
                                        id="edit-icon"
                                        th:href="@{/images/edit.svg} + '#edit'"
                                />
                            </svg>
                        </a>
                    </td>
                </div>
            </tr>
            </tbody>
        </table>
    </div>
</main>
<footer th:replace="~{fragments/footer :: footer}"></footer>
<div th:replace="~{fragments/scripts :: scripts}"></div>
</body>
</html>